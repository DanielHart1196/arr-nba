var he=Object.defineProperty;var fe=(n,e,t)=>e in n?he(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var P=(n,e,t)=>fe(n,typeof e!="symbol"?e+"":e,t);import{h as F,ad as W,aA as ue,a2 as Y,a as pe,a7 as we,l as Z,a9 as me,ab as Se,ac as ee,ae as X,a4 as H,aj as ge,aH as Re,as as te,Z as Ae,a3 as J,aV as ye,a6 as Te,Q as ve,aW as be,aF as Q,aX as Ee,ai as re,aY as Ne,aZ as Ce,A as $e,a_ as I,a$ as ie,$ as ce,a1 as de,b0 as q,q as xe,b1 as _e,b2 as ke,aE as Le,a0 as Pe,aB as Ie}from"./mOB0g_sz.js";import{a as Me}from"./BV6NFH77.js";function et(n,e){return e}function Oe(n,e,t){for(var r=[],a=e.length,o,l=e.length,i=0;i<a;i++){let s=e[i];de(s,()=>{if(o){if(o.pending.delete(s),o.done.add(s),o.pending.size===0){var d=n.outrogroups;V(Q(o.done)),d.delete(o),d.size===0&&(n.outrogroups=null)}}else l-=1},!1)}if(l===0){var h=r.length===0&&t!==null;if(h){var p=t,f=p.parentNode;Le(f),f.append(p),n.items.clear()}V(e,!h)}else o={pending:new Set(e),done:new Set},(n.outrogroups??(n.outrogroups=new Set)).add(o)}function V(n,e=!0){for(var t=0;t<n.length;t++)Pe(n[t],e)}var se;function tt(n,e,t,r,a,o=null){var l=n,i=new Map,h=(e&ie)!==0;if(h){var p=n;l=F?W(ue(p)):p.appendChild(Y())}F&&pe();var f=null,s=ve(()=>{var m=t();return be(m)?m:m==null?[]:Q(m)}),d,u=!0;function w(){c.fallback=f,Ue(c,d,l,e,r),f!==null&&(d.length===0?(f.f&I)===0?ce(f):(f.f^=I,z(f,null,l)):de(f,()=>{f=null}))}var S=we(()=>{d=Z(s);var m=d.length;let $=!1;if(F){var x=me(l)===Se;x!==(m===0)&&(l=ee(),W(l),X(!1),$=!0)}for(var A=new Set,T=Ae,b=Te(),y=0;y<m;y+=1){F&&H.nodeType===ge&&H.data===Re&&(l=H,$=!0,X(!1));var E=d[y],N=r(E,y),v=u?null:i.get(N);v?(v.v&&te(v.v,E),v.i&&te(v.i,y),b&&T.unskip_effect(v.e)):(v=Be(i,u?l:se??(se=Y()),E,N,y,a,e,t),u||(v.e.f|=I),i.set(N,v)),A.add(N)}if(m===0&&o&&!f&&(u?f=J(()=>o(l)):(f=J(()=>o(se??(se=Y()))),f.f|=I)),m>A.size&&ye(),F&&m>0&&W(ee()),!u)if(b){for(const[O,g]of i)A.has(O)||T.skip_effect(g.e);T.oncommit(w),T.ondiscard(()=>{})}else w();$&&X(!0),Z(s)}),c={effect:S,items:i,outrogroups:null,fallback:f};u=!1,F&&(l=H)}function G(n){for(;n!==null&&(n.f&_e)===0;)n=n.next;return n}function Ue(n,e,t,r,a){var v,O,g,L,C,B,U,D,k;var o=(r&ke)!==0,l=e.length,i=n.items,h=G(n.effect.first),p,f=null,s,d=[],u=[],w,S,c,m;if(o)for(m=0;m<l;m+=1)w=e[m],S=a(w,m),c=i.get(S).e,(c.f&I)===0&&((O=(v=c.nodes)==null?void 0:v.a)==null||O.measure(),(s??(s=new Set)).add(c));for(m=0;m<l;m+=1){if(w=e[m],S=a(w,m),c=i.get(S).e,n.outrogroups!==null)for(const R of n.outrogroups)R.pending.delete(c),R.done.delete(c);if((c.f&I)!==0)if(c.f^=I,c===h)z(c,null,t);else{var $=f?f.next:h;c===n.effect.last&&(n.effect.last=c.prev),c.prev&&(c.prev.next=c.next),c.next&&(c.next.prev=c.prev),M(n,f,c),M(n,c,$),z(c,$,t),f=c,d=[],u=[],h=G(f.next);continue}if((c.f&q)!==0&&(ce(c),o&&((L=(g=c.nodes)==null?void 0:g.a)==null||L.unfix(),(s??(s=new Set)).delete(c))),c!==h){if(p!==void 0&&p.has(c)){if(d.length<u.length){var x=u[0],A;f=x.prev;var T=d[0],b=d[d.length-1];for(A=0;A<d.length;A+=1)z(d[A],x,t);for(A=0;A<u.length;A+=1)p.delete(u[A]);M(n,T.prev,b.next),M(n,f,T),M(n,b,x),h=x,f=b,m-=1,d=[],u=[]}else p.delete(c),z(c,h,t),M(n,c.prev,c.next),M(n,c,f===null?n.effect.first:f.next),M(n,f,c),f=c;continue}for(d=[],u=[];h!==null&&h!==c;)(p??(p=new Set)).add(h),u.push(h),h=G(h.next);if(h===null)continue}(c.f&I)===0&&d.push(c),f=c,h=G(c.next)}if(n.outrogroups!==null){for(const R of n.outrogroups)R.pending.size===0&&(V(Q(R.done)),(C=n.outrogroups)==null||C.delete(R));n.outrogroups.size===0&&(n.outrogroups=null)}if(h!==null||p!==void 0){var y=[];if(p!==void 0)for(c of p)(c.f&q)===0&&y.push(c);for(;h!==null;)(h.f&q)===0&&h!==n.fallback&&y.push(h),h=G(h.next);var E=y.length;if(E>0){var N=(r&ie)!==0&&l===0?t:null;if(o){for(m=0;m<E;m+=1)(U=(B=y[m].nodes)==null?void 0:B.a)==null||U.measure();for(m=0;m<E;m+=1)(k=(D=y[m].nodes)==null?void 0:D.a)==null||k.fix()}Oe(n,y,N)}}o&&xe(()=>{var R,_;if(s!==void 0)for(c of s)(_=(R=c.nodes)==null?void 0:R.a)==null||_.apply()})}function Be(n,e,t,r,a,o,l,i){var h=(l&Ne)!==0?(l&Ce)===0?$e(t,!1,!1):re(t):null,p=(l&Ee)!==0?re(a):null;return{v:h,i:p,e:J(()=>(o(e,h??t,p??a,i),()=>{n.delete(r)}))}}function z(n,e,t){if(n.nodes)for(var r=n.nodes.start,a=n.nodes.end,o=e&&(e.f&I)===0?e.nodes.start:t;r!==null;){var l=Ie(r);if(o.before(r),r===a)return;r=l}}function M(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}class De{constructor(){P(this,"cache",new Map);P(this,"defaultTTL",300*1e3);P(this,"maxEntries",400);P(this,"pendingRequests",new Map)}set(e,t,r=this.defaultTTL){if(!this.cache.has(e)&&this.cache.size>=this.maxEntries){const a=this.cache.keys().next().value;a&&this.cache.delete(a)}this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}get(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}async getOrFetch(e,t,r){const a=this.get(e);if(a!==null)return a;const o=this.pendingRequests.get(e);if(o)return o;const l=t().then(i=>(this.set(e,i,r),this.pendingRequests.delete(e),i)).catch(i=>{throw this.pendingRequests.delete(e),i});return this.pendingRequests.set(e,l),l}clear(){this.cache.clear()}delete(e){return this.cache.delete(e)}size(){return this.cache.size}cleanup(){const e=Date.now();for(const[t,r]of this.cache.entries())e-r.timestamp>r.ttl&&this.cache.delete(t)}}const ne=new De;class Fe{async getScoreboard(e){const t=e?`https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard?dates=${e}`:"https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard",r=await fetch(t);if(!r.ok)throw new Error(`ESPN Scoreboard error: ${r.status}`);return r.json()}async getSummary(e){const t=await fetch(`https://site.web.api.espn.com/apis/site/v2/sports/basketball/nba/summary?event=${e}`);if(!t.ok)throw new Error(`ESPN Summary error: ${t.status}`);return t.json()}}function Ge(n){const[e,t]=(n??"").split("-"),r=Number(e??0)||0,a=Number(t??0)||0,o=a>0?Math.round(r/a*100):0;return{attempts:a,makes:r,pct:o}}function ae(n){if(typeof n=="string"){if(n.toUpperCase()==="DNP")return 0;const r=/^(\d+):(\d+)$/.exec(n);if(r)return parseInt(r[1])*60+parseInt(r[2]);const a=Number(n);return isNaN(a)?0:a}const e=Number(n);return isNaN(e)?0:e}function ze(n,e){var h,p,f;const t=((h=n==null?void 0:n.boxscore)==null?void 0:h.players)??[],r=["MIN","PTS","FG","3PT","FT","REB","AST","TO","STL","BLK","OREB","DREB","PF","+/-"],a=(p=e==null?void 0:e.competitions)==null?void 0:p[0],o=new Map,l=(a==null?void 0:a.competitors)??[];for(const s of l){const d=String(((f=s==null?void 0:s.team)==null?void 0:f.id)??""),u=(s==null?void 0:s.homeAway)==="home"?"home":"away";d&&o.set(d,u)}const i={home:[],away:[]};return t.forEach((s,d)=>{var x,A,T,b,y,E,N,v,O;const u=String(((x=s==null?void 0:s.team)==null?void 0:x.id)??"");(A=s==null?void 0:s.team)==null||A.displayName;let w;o.has(u)?w=o.get(u):(T=s==null?void 0:s.team)!=null&&T.homeAway?w=s.team.homeAway==="home"?"home":"away":w=d===0?"away":"home";let S=w;i[S].length>0&&(S=S==="home"?"away":"home");const c=((y=(b=s==null?void 0:s.statistics)==null?void 0:b[0])==null?void 0:y.names)??[],m=((N=(E=s==null?void 0:s.statistics)==null?void 0:E[0])==null?void 0:N.athletes)??[],$=[];for(const g of m){const L=((v=g==null?void 0:g.athlete)==null?void 0:v.displayName)??((O=g==null?void 0:g.athlete)==null?void 0:O.shortName)??"Unknown",C={},B=Array.isArray(g==null?void 0:g.stats)?g.stats:[];for(let k=0;k<c.length;k++){const R=c[k],_=B[k];if(R==="FG"||R==="3PT"||R==="FT"){const j=Ge(typeof _=="string"?_:String(_??"0-0")),K=R==="3PT"?"3P":R;C[`${K}A`]=j.attempts,C[`${K}M`]=j.makes,C[`${K}%`]=j.pct}else R==="MIN"?C.MIN=typeof _=="string"?_:String(_??""):R==="+/-"?C["+/-"]=Number(_??0):R&&(C[R]=Number(_??0))}const U=C.MIN,D=(g==null?void 0:g.didNotPlay)===!0||typeof U=="string"&&U.toUpperCase()==="DNP";$.push({name:L,dnp:D,stats:C})}$.sort((g,L)=>{var k,R;const C=ae((k=g==null?void 0:g.stats)==null?void 0:k.MIN),B=ae((R=L==null?void 0:L.stats)==null?void 0:R.MIN),U=g.dnp||C<=0?1:0,D=L.dnp||B<=0?1:0;return U-D}),i[S]=$}),{players:i,names:r}}function He(n,e){var a,o,l,i,h,p,f;const t=((a=n==null?void 0:n.boxscore)==null?void 0:a.teams)??[],r={home:{team:{},periods:[],total:0},away:{team:{},periods:[],total:0}};for(const s of t){let d=((o=s==null?void 0:s.team)==null?void 0:o.homeAway)==="home"?"home":"away";(r[d].total!==0||Object.keys(r[d].team).length!==0)&&(d=d==="home"?"away":"home");const w=((s==null?void 0:s.linescores)??[]).map(c=>Number((c==null?void 0:c.value)??0)),S=Number((s==null?void 0:s.score)??0);r[d]={team:s==null?void 0:s.team,periods:w,total:S}}if((!((l=r.home.periods)!=null&&l.length)||!((i=r.away.periods)!=null&&i.length))&&e){const s=(h=e==null?void 0:e.competitions)==null?void 0:h[0],d=(p=s==null?void 0:s.competitors)==null?void 0:p.find(S=>S.homeAway==="away"),u=(f=s==null?void 0:s.competitors)==null?void 0:f.find(S=>S.homeAway==="home"),w=S=>(S??[]).map(c=>Number((c==null?void 0:c.value)??0));d&&(r.away={team:d.team,periods:w((d==null?void 0:d.linescores)??[]),total:Number(d.score??0)}),u&&(r.home={team:u.team,periods:w((u==null?void 0:u.linescores)??[]),total:Number(u.score??0)})}return r}class je{transformBoxscore(e,t){const{players:r,names:a}=ze(e,t),o=He(e,t),l=(()=>{var u,w,S,c;const i=(u=t==null?void 0:t.competitions)==null?void 0:u[0],h=(w=i==null?void 0:i.status)==null?void 0:w.type,p=((S=i==null?void 0:i.status)==null?void 0:S.displayClock)||"",f=((c=i==null?void 0:i.status)==null?void 0:c.period)||0,s=(h==null?void 0:h.shortDetail)||"",d=(h==null?void 0:h.name)||"";return{clock:p,period:f,short:s,name:d}})();return{id:(e==null?void 0:e.id)||(t==null?void 0:t.id)||"",boxscore:(e==null?void 0:e.boxscore)??{},players:r,linescores:o,names:a,status:l}}}class Ke{constructor(){P(this,"BASE_URL","/api/reddit");P(this,"USER_AGENT","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 (arr-nba app)")}async getIndex(){if(typeof window<"u"){const e=await fetch(`${this.BASE_URL}/index`);if(!e.ok)throw new Error(`Reddit Index error: ${e.status}`);return e.json()}else{const e="https://www.reddit.com/r/nba/search.json?q=Daily%20Game%20Thread%20Index&restrict_sr=1&sort=new";console.log(`Fetching Reddit index from: ${e}`);const t=await fetch(e,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!t.ok){const r=await t.text();throw console.error(`Reddit Index error ${t.status}: ${r.slice(0,100)}`),new Error(`Reddit Index error: ${t.status}`)}return t.json()}}async searchRaw(e){if(typeof window<"u"){const t=await fetch(`${this.BASE_URL}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})});if(!t.ok)throw new Error(`Reddit Search error: ${t.status}`);return t.json()}else{const t=`https://www.reddit.com/r/nba/search.json?q=${encodeURIComponent(e)}&restrict_sr=1&sort=new&t=week`;console.log(`Searching Reddit with: ${t}`);const r=await fetch(t,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!r.ok){const a=await r.text();throw console.error(`Reddit Search error ${r.status}: ${a.slice(0,100)}`),new Error(`Reddit Search error: ${r.status}`)}return r.json()}}async getCommentsRaw(e,t,r){if(typeof window<"u"){const a=new URL(`${window.location.origin}${this.BASE_URL}/comments/${e}`);a.searchParams.set("sort",t),r&&a.searchParams.set("permalink",r);const o=await fetch(a.toString());if(!o.ok){console.warn(`Reddit Comments API Route error ${o.status}, trying direct fetch...`);const l=r?`https://www.reddit.com${r}.json?sort=${t}`:`https://www.reddit.com/comments/${e}.json?sort=${t}`,i=await fetch(l);if(!i.ok)throw new Error(`Reddit Comments direct error: ${i.status}`);return i.json()}return o.json()}else{const a=r?`https://www.reddit.com${r}.json?sort=${t}`:`https://www.reddit.com/comments/${e}.json?sort=${t}`;console.log(`Fetching Reddit comments from: ${a}`);const o=await fetch(a,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!o.ok){const l=await o.text();throw console.error(`Reddit Comments error ${o.status}: ${l.slice(0,100)}`),new Error(`Reddit Comments error: ${o.status}`)}return o.json()}}async getThreadContent(e){if(typeof window<"u"){const t=new URL(`${window.location.origin}${this.BASE_URL}/comments/none`);t.searchParams.set("permalink",e);const r=await fetch(t.toString());if(!r.ok)throw new Error(`Reddit Thread Content error: ${r.status}`);return r.json()}else{const t=`https://www.reddit.com${e}.json`;console.log(`Fetching Reddit thread content from: ${t}`);const r=await fetch(t,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!r.ok){const a=await r.text();throw console.error(`Reddit Thread Content error ${r.status}: ${a.slice(0,100)}`),new Error(`Reddit Thread Content error: ${r.status}`)}return r.json()}}async getSubredditFeed(e,t="new"){if(typeof window<"u"){const r=await fetch(`${this.BASE_URL}/subreddit/${e}?sort=${t}`);if(!r.ok)throw new Error(`Reddit Subreddit Feed error: ${r.status}`);return r.json()}else{const r=`https://www.reddit.com/r/${e}/${t}.json?limit=100`;console.log(`Fetching Reddit subreddit feed from: ${r}`);const a=await fetch(r,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!a.ok){const o=await a.text();throw console.error(`Reddit Subreddit Feed error ${a.status}: ${o.slice(0,100)}`),new Error(`Reddit Subreddit Feed error: ${a.status}`)}return a.json()}}async fetchRaw(e){const t={};typeof window>"u"&&(t.headers={"User-Agent":this.USER_AGENT});const r=await fetch(e,t);if(!r.ok)throw new Error(`Reddit fetchRaw error: ${r.status}`);return r.json()}}class We{transformSearch(e,t){var f;const r=((f=e==null?void 0:e.data)==null?void 0:f.children)??[],a=Date.now()/1e3,o=t==="post"?36*3600:24*3600;return{post:r.filter(s=>{var d;return a-(((d=s==null?void 0:s.data)==null?void 0:d.created_utc)??a)<=o}).filter(s=>{var w;const d=(((w=s==null?void 0:s.data)==null?void 0:w.title)||"").toLowerCase(),u=d.includes("post game thread")||d.includes("post-game thread")||d.includes("postgame thread");return t==="post"?u:d.includes("game thread")&&!u}).sort((s,d)=>{var u,w;return(((u=d.data)==null?void 0:u.created_utc)??0)-(((w=s.data)==null?void 0:w.created_utc)??0)}).map(s=>{var d,u,w,S,c,m;return{id:(d=s==null?void 0:s.data)==null?void 0:d.id,title:(u=s==null?void 0:s.data)==null?void 0:u.title,permalink:(w=s==null?void 0:s.data)==null?void 0:w.permalink,url:`https://www.reddit.com${(S=s==null?void 0:s.data)==null?void 0:S.permalink}`,created_utc:(c=s==null?void 0:s.data)==null?void 0:c.created_utc,score:(m=s==null?void 0:s.data)==null?void 0:m.score}})[0]||null}}transformComments(e){var r;if(!e||!Array.isArray(e))return console.error("Reddit Transformer: Invalid JSON structure for comments:",(r=JSON.stringify(e))==null?void 0:r.slice(0,200)),{comments:[]};const t=e[1];return t||console.warn("Reddit Transformer: No comments data found in json[1]"),{comments:this.toTree(t)}}transformIndex(e){var l,i,h,p,f,s,d;const r=(((f=(p=(h=(i=(l=e==null?void 0:e[0])==null?void 0:l.data)==null?void 0:i.children)==null?void 0:h[0])==null?void 0:p.data)==null?void 0:f.selftext)??"").split(`
`),a={};for(const u of r){const w=/\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/.exec(u);if(!w)continue;const S=w[1],c=w[2],m=S.toLowerCase().includes("post game thread"),$=((s=S.split(":")[1])==null?void 0:s.trim())??S,[x,A]=$.split(" at ").map(N=>N==null?void 0:N.trim());if(!x||!A)continue;const T=[this.mascotName(x),this.mascotName(A)].sort().join("|"),b=/comments\/([a-z0-9]+)\//.exec(c),y=(b==null?void 0:b[1])??"";a[T]=a[T]||{};const E={id:y,title:S,url:c};m?a[T].pgt=E:a[T].gdt=E}const o=["Knicks","76ers"].sort().join("|");return(d=a[o])!=null&&d.pgt,{mapping:a}}mascotName(e){const t=(e||"").toLowerCase(),r=["trail blazers","knicks","76ers","lakers","celtics","warriors","nets","raptors","bulls","cavaliers","pistons","pacers","bucks","heat","magic","hawks","hornets","wizards","mavericks","rockets","grizzlies","pelicans","spurs","nuggets","timberwolves","suns","kings","clippers","thunder","jazz","blazers"];for(const a of r)if(t.includes(a))return a==="blazers"||a==="trail blazers"?"Trail Blazers":a.split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");return e}toTree(e,t=0){var o;if(!e||!e.data||!e.data.children)return t===0&&console.warn("Reddit Transformer: toTree called with invalid structure:",(o=JSON.stringify(e))==null?void 0:o.slice(0,200)),[];const r=e.data.children,a=[];for(const l of r){const i=l==null?void 0:l.data;if((l==null?void 0:l.kind)!=="t1")continue;const h={id:i==null?void 0:i.id,author:i==null?void 0:i.author,score:(i==null?void 0:i.score)??0,body:(i==null?void 0:i.body)??"",created_utc:(i==null?void 0:i.created_utc)??0};t<2&&(i!=null&&i.replies)&&typeof i.replies=="object"&&(h.replies=this.toTree(i.replies,t+1)),a.push(h)}return a}}let Ye=class{constructor(e,t,r){this.dataSource=e,this.transformer=t,this.cache=r}async getScoreboard(e){const t=e?`scoreboard:${e}`:"scoreboard";return this.cache.getOrFetch(t,async()=>{const r=await this.dataSource.getScoreboard(e);return{events:(r==null?void 0:r.events)??[]}},30*1e3)}async getBoxscore(e){const t=`boxscore:${e}`;return this.cache.getOrFetch(t,async()=>{const[r,a]=await Promise.all([this.dataSource.getSummary(e),this.getScoreboard()]),o=a.events.find(l=>String(l.id)===String(e));return this.transformer.transformBoxscore(r,o)},15*1e3)}async prewarmBoxscores(e){const t=e.map(r=>this.getBoxscore(r).catch(a=>{console.warn(`Failed to prewarm boxscore ${r}:`,a)}));await Promise.allSettled(t)}cleanupCache(){this.cache.cleanup&&this.cache.cleanup()}};class Xe{constructor(e,t,r){this.dataSource=e,this.transformer=t,this.cache=r}readBrowserCache(e,t){if(typeof window>"u")return null;try{const r=localStorage.getItem(e);if(!r)return null;const a=JSON.parse(r);return!a||typeof a.ts!="number"||Date.now()-a.ts>t?null:a.data}catch{return null}}writeBrowserCache(e,t){if(!(typeof window>"u"))try{localStorage.setItem(e,JSON.stringify({ts:Date.now(),data:t}))}catch{}}async getRedditIndex(){var a,o,l;const e="reddit:index",t=this.cache.get(e);if(t&&!(t instanceof Promise))return t;const r=this.readBrowserCache(e,600*1e3);if(r)return this.cache.set(e,r,6e5),r;try{let i;try{i=await this.dataSource.searchRaw("Daily Game Thread Index")}catch(s){if(s.message.includes("403")||s.message.includes("429"))console.warn("Reddit Index search blocked, falling back to hot feed"),i=await this.dataSource.getSubredditFeed("nba","hot");else throw s}const h=((a=i==null?void 0:i.data)==null?void 0:a.children)??[],f=h.sort((s,d)=>{var u,w;return(((u=d.data)==null?void 0:u.created_utc)??0)-(((w=s.data)==null?void 0:w.created_utc)??0)}).find(s=>{var d,u,w;return(w=(u=(d=s==null?void 0:s.data)==null?void 0:d.title)==null?void 0:u.toLowerCase())==null?void 0:w.includes("daily game thread index")});if(!f){if(h.length>0&&!h.some(s=>{var d,u,w;return(w=(u=(d=s==null?void 0:s.data)==null?void 0:d.title)==null?void 0:u.toLowerCase())==null?void 0:w.includes("daily game thread index")})){const s=await this.dataSource.getSubredditFeed("nba","hot"),d=(l=(o=s==null?void 0:s.data)==null?void 0:o.children)==null?void 0:l.find(u=>{var w,S,c;return(c=(S=(w=u==null?void 0:u.data)==null?void 0:w.title)==null?void 0:S.toLowerCase())==null?void 0:c.includes("daily game thread index")});if(d)return this.processIndexPost(d.data,e)}return{}}return this.processIndexPost(f.data,e)}catch(i){return console.error("Error fetching Reddit Index:",i),{}}}async processIndexPost(e,t){const r=await this.dataSource.getThreadContent(e.permalink),{mapping:a}=this.transformer.transformIndex(r);return this.cache.set(t,a,6e5),this.writeBrowserCache(t,a),a}async searchRedditThread(e){const t=this.buildSearchQuery(e);let r;try{r=await this.dataSource.searchRaw(t)}catch(o){if(o.message.includes("403")||o.message.includes("429"))return console.warn("Reddit search blocked, falling back to feed-based search"),this.fallbackSearchFromFeed(e);throw o}return this.transformer.transformSearch(r,e.type)}async fallbackSearchFromFeed(e){var t,r;try{const[a,o]=await Promise.all([this.dataSource.getSubredditFeed("nba","new"),this.dataSource.getSubredditFeed("nba","hot")]),l=[...((t=a==null?void 0:a.data)==null?void 0:t.children)??[],...((r=o==null?void 0:o.data)==null?void 0:r.children)??[]],i=new Set,p={data:{children:l.filter(f=>i.has(f.data.id)?!1:(i.add(f.data.id),!0))}};return this.transformer.transformSearch(p,e.type==="post"?"post":"live")}catch(a){return console.error("Fallback feed search failed:",a),{post:void 0}}}async getRedditComments(e,t="new",r,a=!1){const o=`reddit:comments:${e}:${t}`,l=t==="top"?12e4:3e4,i=this.cache.get(o);if(i&&!(i instanceof Promise)&&!a)return i;if(!a){const f=this.readBrowserCache(o,l);if(f)return this.cache.set(o,f,l),f}const h=await this.dataSource.getCommentsRaw(e,t,r),p=this.transformer.transformComments(h);return this.cache.set(o,p,l),this.writeBrowserCache(o,p),p}buildSearchQuery(e){const t=e.type==="post"?'"POST GAME THREAD"':'"GAME THREAD"',r=[...e.awayCandidates,...e.homeCandidates].map(o=>`"${o}"`).join(" "),a=e.type==="live"?' -"POST GAME THREAD"':"";return`${t} ${r}${a}`}clearRedditCache(){this.cache.clear()}}class qe{constructor(){P(this,"nbaService");P(this,"redditService");const e=new Fe,t=new je,r=new Ke,a=new We;this.nbaService=new Ye(e,t,ne),this.redditService=new Xe(r,a,ne)}async getScoreboard(e){return this.nbaService.getScoreboard(e)}async getBoxscore(e){return this.nbaService.getBoxscore(e)}async getRedditIndex(){return this.redditService.getRedditIndex()}async searchRedditThread(e){return this.redditService.searchRedditThread(e)}async getRedditComments(e,t="new",r,a=!1){return this.redditService.getRedditComments(e,t,r,a)}async prewarmBoxscores(e){return this.nbaService.prewarmBoxscores(e)}clearRedditCache(){this.redditService.clearRedditCache()}async forceRefreshReddit(){this.clearRedditCache()}cleanupCache(){this.nbaService.cleanupCache()}}const st=new qe;function oe(n){return(n||"").toLowerCase().includes("trail blazers")?"Trail Blazers":n}function Je(n,e){return[oe(n),oe(e)].sort().join("|")}function nt(n){const e=Math.floor(Date.now()/1e3),t=Math.max(0,e-(Number(n)||0));if(t<60)return"just now";const r=Math.floor(t/60);if(r<60)return`${r}m ago`;const a=Math.floor(r/60);return a<24?`${a}h ago`:`${Math.floor(a/24)}d ago`}async function le(n,e,t){if(!e||!t)return{};const r=Je(e,t),a=await n.getRedditIndex(),o=a==null?void 0:a[r];let l=o==null?void 0:o.gdt,i=o==null?void 0:o.pgt;const h=[];return l||h.push(n.searchRedditThread({type:"live",awayCandidates:[e],homeCandidates:[t]}).then(p=>{p!=null&&p.post&&(l=p.post)}).catch(()=>{})),i||h.push(n.searchRedditThread({type:"post",awayCandidates:[e],homeCandidates:[t]}).then(p=>{p!=null&&p.post&&(i=p.post)}).catch(()=>{})),h.length>0&&await Promise.allSettled(h),{liveThread:l,postThread:i}}async function at(n,e,t){const{liveThread:r,postThread:a}=await le(n,e,t);r&&n.getRedditComments(r.id,"new",r.permalink).catch(()=>{}),a&&n.getRedditComments(a.id,"top",a.permalink).catch(()=>{})}async function ot(n,e,t){const{liveThread:r}=await le(n,e,t);r&&await n.getRedditComments(r.id,"new",r.permalink,!0)}function it(n){const e=((n==null?void 0:n.abbreviation)||"").toUpperCase(),t={SA:"SAS",NO:"NOP",GS:"GSW",NY:"NYK",PHO:"PHX",WSH:"WAS",UTAH:"UTA",TOR:"TOR",MIN:"MIN",MIA:"MIA",SAS:"SAS"},r=((n==null?void 0:n.shortDisplayName)||(n==null?void 0:n.displayName)||"").toUpperCase(),a={UTAH:"UTA","LOS ANGELES CLIPPERS":"LAC","LA CLIPPERS":"LAC","LOS ANGELES LAKERS":"LAL","LA LAKERS":"LAL","GOLDEN STATE":"GSW","NEW ORLEANS":"NOP","SAN ANTONIO":"SAS","NEW YORK":"NYK",PHOENIX:"PHX",WASHINGTON:"WAS"},o=t[e]||e;return!a[r]&&r.includes("UTAH")?"UTA":a[r]||o||""}function ct(n={}){let e=0,t=0,r=!1;const a=n.threshold||50,o=n.target||(typeof document<"u"?document:null);if(!o)return{destroy:()=>{}};function l(p){var w,S,c,m;const f=(w=p.touches)==null?void 0:w[0];if(!f)return;e=f.clientX,t=f.clientY,r=!1;const s=p.target,d=!!((S=s==null?void 0:s.closest)!=null&&S.call(s,".swipe-area"))||document.body.classList.contains("swipe-area")||document.documentElement.classList.contains("swipe-area"),u=!!((c=s==null?void 0:s.closest)!=null&&c.call(s,'[data-scrollable="true"]'))||!!((m=s==null?void 0:s.closest)!=null&&m.call(s,".scroll-container"));d?r=!1:u&&(r=!0)}function i(p){var u;const f=(u=p.changedTouches)==null?void 0:u[0];if(!f)return;const s=f.clientX-e,d=f.clientY-t;Math.abs(s)>a&&Math.abs(d)<100&&(r||(s>0&&n.onSwipeRight?n.onSwipeRight():s<0&&n.onSwipeLeft&&n.onSwipeLeft())),Math.abs(d)>a&&Math.abs(s)<40&&(d>0&&n.onSwipeDown?n.onSwipeDown():d<0&&n.onSwipeUp&&n.onSwipeUp()),e=0,t=0,r=!1}typeof window<"u"&&(o.addEventListener("touchstart",l,{capture:!0,passive:!0}),o.addEventListener("touchend",i,{capture:!0,passive:!0}));const h=()=>{o.removeEventListener("touchstart",l,{capture:!0}),o.removeEventListener("touchend",i,{capture:!0})};try{Me(h)}catch{}return{destroy:h}}export{Je as a,ct as c,tt as e,nt as f,it as g,et as i,st as n,at as p,ot as r};
