var he=Object.defineProperty;var ue=(s,e,t)=>e in s?he(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var I=(s,e,t)=>ue(s,typeof e!="symbol"?e+"":e,t);import{h as L,ac as Y,aC as fe,a1 as W,a as pe,a6 as we,l as Z,a8 as me,aa as Se,ab as ee,ad as X,a3 as H,al as ge,aJ as Re,au as te,R as ye,a2 as q,aV as ve,a5 as Ae,G as Te,aW as be,aH as Q,aX as Ne,ak as re,aY as Ee,aZ as Ce,Z as _e,a_ as M,a$ as ie,_ as ce,a0 as de,b0 as J,q as $e,b1 as xe,b2 as ke,aG as Le,$ as Pe,aD as Ie}from"./B3tR_vzS.js";import{a as Me}from"./9E4dF-An.js";function rt(s,e){return e}function Oe(s,e,t){for(var r=[],n=e.length,o,h=e.length,i=0;i<n;i++){let a=e[i];de(a,()=>{if(o){if(o.pending.delete(a),o.done.add(a),o.pending.size===0){var l=s.outrogroups;V(Q(o.done)),l.delete(o),l.size===0&&(s.outrogroups=null)}}else h-=1},!1)}if(h===0){var u=r.length===0&&t!==null;if(u){var w=t,f=w.parentNode;Le(f),f.append(w),s.items.clear()}V(e,!u)}else o={pending:new Set(e),done:new Set},(s.outrogroups??(s.outrogroups=new Set)).add(o)}function V(s,e=!0){for(var t=0;t<s.length;t++)Pe(s[t],e)}var se;function st(s,e,t,r,n,o=null){var h=s,i=new Map,u=(e&ie)!==0;if(u){var w=s;h=L?Y(fe(w)):w.appendChild(W())}L&&pe();var f=null,a=Te(()=>{var m=t();return be(m)?m:m==null?[]:Q(m)}),l,c=!0;function p(){d.fallback=f,Ue(d,l,h,e,r),f!==null&&(l.length===0?(f.f&M)===0?ce(f):(f.f^=M,F(f,null,h)):de(f,()=>{f=null}))}var S=we(()=>{l=Z(a);var m=l.length;let v=!1;if(L){var T=me(h)===Se;T!==(m===0)&&(h=ee(),Y(h),X(!1),v=!0)}for(var y=new Set,b=ye,E=Ae(),A=0;A<m;A+=1){L&&H.nodeType===ge&&H.data===Re&&(h=H,v=!0,X(!1));var C=l[A],_=r(C,A),N=c?null:i.get(_);N?(N.v&&te(N.v,C),N.i&&te(N.i,A),E&&b.unskip_effect(N.e)):(N=Be(i,c?h:se??(se=W()),C,_,A,n,e,t),c||(N.e.f|=M),i.set(_,N)),y.add(_)}if(m===0&&o&&!f&&(c?f=q(()=>o(h)):(f=q(()=>o(se??(se=W()))),f.f|=M)),m>y.size&&ve(),L&&m>0&&Y(ee()),!c)if(E){for(const[U,g]of i)y.has(U)||b.skip_effect(g.e);b.oncommit(p),b.ondiscard(()=>{})}else p();v&&X(!0),Z(a)}),d={effect:S,items:i,outrogroups:null,fallback:f};c=!1,L&&(h=H)}function z(s){for(;s!==null&&(s.f&xe)===0;)s=s.next;return s}function Ue(s,e,t,r,n){var N,U,g,P,$,D,B,G,k;var o=(r&ke)!==0,h=e.length,i=s.items,u=z(s.effect.first),w,f=null,a,l=[],c=[],p,S,d,m;if(o)for(m=0;m<h;m+=1)p=e[m],S=n(p,m),d=i.get(S).e,(d.f&M)===0&&((U=(N=d.nodes)==null?void 0:N.a)==null||U.measure(),(a??(a=new Set)).add(d));for(m=0;m<h;m+=1){if(p=e[m],S=n(p,m),d=i.get(S).e,s.outrogroups!==null)for(const R of s.outrogroups)R.pending.delete(d),R.done.delete(d);if((d.f&M)!==0)if(d.f^=M,d===u)F(d,null,t);else{var v=f?f.next:u;d===s.effect.last&&(s.effect.last=d.prev),d.prev&&(d.prev.next=d.next),d.next&&(d.next.prev=d.prev),O(s,f,d),O(s,d,v),F(d,v,t),f=d,l=[],c=[],u=z(f.next);continue}if((d.f&J)!==0&&(ce(d),o&&((P=(g=d.nodes)==null?void 0:g.a)==null||P.unfix(),(a??(a=new Set)).delete(d))),d!==u){if(w!==void 0&&w.has(d)){if(l.length<c.length){var T=c[0],y;f=T.prev;var b=l[0],E=l[l.length-1];for(y=0;y<l.length;y+=1)F(l[y],T,t);for(y=0;y<c.length;y+=1)w.delete(c[y]);O(s,b.prev,E.next),O(s,f,b),O(s,E,T),u=T,f=E,m-=1,l=[],c=[]}else w.delete(d),F(d,u,t),O(s,d.prev,d.next),O(s,d,f===null?s.effect.first:f.next),O(s,f,d),f=d;continue}for(l=[],c=[];u!==null&&u!==d;)(w??(w=new Set)).add(u),c.push(u),u=z(u.next);if(u===null)continue}(d.f&M)===0&&l.push(d),f=d,u=z(d.next)}if(s.outrogroups!==null){for(const R of s.outrogroups)R.pending.size===0&&(V(Q(R.done)),($=s.outrogroups)==null||$.delete(R));s.outrogroups.size===0&&(s.outrogroups=null)}if(u!==null||w!==void 0){var A=[];if(w!==void 0)for(d of w)(d.f&J)===0&&A.push(d);for(;u!==null;)(u.f&J)===0&&u!==s.fallback&&A.push(u),u=z(u.next);var C=A.length;if(C>0){var _=(r&ie)!==0&&h===0?t:null;if(o){for(m=0;m<C;m+=1)(B=(D=A[m].nodes)==null?void 0:D.a)==null||B.measure();for(m=0;m<C;m+=1)(k=(G=A[m].nodes)==null?void 0:G.a)==null||k.fix()}Oe(s,A,_)}}o&&$e(()=>{var R,x;if(a!==void 0)for(d of a)(x=(R=d.nodes)==null?void 0:R.a)==null||x.apply()})}function Be(s,e,t,r,n,o,h,i){var u=(h&Ee)!==0?(h&Ce)===0?_e(t,!1,!1):re(t):null,w=(h&Ne)!==0?re(n):null;return{v:u,i:w,e:q(()=>(o(e,u??t,w??n,i),()=>{s.delete(r)}))}}function F(s,e,t){if(s.nodes)for(var r=s.nodes.start,n=s.nodes.end,o=e&&(e.f&M)===0?e.nodes.start:t;r!==null;){var h=Ie(r);if(o.before(r),r===n)return;r=h}}function O(s,e,t){e===null?s.effect.first=t:e.next=t,t===null?s.effect.last=e:t.prev=e}function De(s,e,t){var r=s==null?"":""+s;return r===""?null:r}function Ge(s,e){return s==null?null:String(s)}function nt(s,e,t,r,n,o){var h=s.__className;if(L||h!==t||h===void 0){var i=De(t);(!L||i!==s.getAttribute("class"))&&(i==null?s.removeAttribute("class"):s.className=i),s.__className=t}return o}function at(s,e,t,r){var n=s.__style;if(L||n!==e){var o=Ge(e);(!L||o!==s.getAttribute("style"))&&(o==null?s.removeAttribute("style"):s.style.cssText=o),s.__style=e}return r}class ze{constructor(){I(this,"cache",new Map);I(this,"defaultTTL",300*1e3);I(this,"maxEntries",400);I(this,"pendingRequests",new Map)}set(e,t,r=this.defaultTTL){if(!this.cache.has(e)&&this.cache.size>=this.maxEntries){const n=this.cache.keys().next().value;n&&this.cache.delete(n)}this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}get(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}async getOrFetch(e,t,r){const n=this.get(e);if(n!==null)return n;const o=this.pendingRequests.get(e);if(o)return o;const h=t().then(i=>(this.set(e,i,r),this.pendingRequests.delete(e),i)).catch(i=>{throw this.pendingRequests.delete(e),i});return this.pendingRequests.set(e,h),h}clear(){this.cache.clear()}delete(e){return this.cache.delete(e)}size(){return this.cache.size}cleanup(){const e=Date.now();for(const[t,r]of this.cache.entries())e-r.timestamp>r.ttl&&this.cache.delete(t)}}const ne=new ze;class Fe{async getScoreboard(e){const t=e?`https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard?dates=${e}`:"https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard",r=await fetch(t);if(!r.ok)throw new Error(`ESPN Scoreboard error: ${r.status}`);return r.json()}async getSummary(e){const t=await fetch(`https://site.web.api.espn.com/apis/site/v2/sports/basketball/nba/summary?event=${e}`);if(!t.ok)throw new Error(`ESPN Summary error: ${t.status}`);return t.json()}}function He(s){const[e,t]=(s??"").split("-"),r=Number(e??0)||0,n=Number(t??0)||0,o=n>0?Math.round(r/n*100):0;return{attempts:n,makes:r,pct:o}}function ae(s){if(typeof s=="string"){if(s.toUpperCase()==="DNP")return 0;const r=/^(\d+):(\d+)$/.exec(s);if(r)return parseInt(r[1])*60+parseInt(r[2]);const n=Number(s);return isNaN(n)?0:n}const e=Number(s);return isNaN(e)?0:e}function je(s,e){var u,w,f;const t=((u=s==null?void 0:s.boxscore)==null?void 0:u.players)??[],r=["MIN","PTS","FG","3PT","FT","REB","AST","TO","STL","BLK","OREB","DREB","PF","+/-"],n=(w=e==null?void 0:e.competitions)==null?void 0:w[0],o=new Map,h=(n==null?void 0:n.competitors)??[];for(const a of h){const l=String(((f=a==null?void 0:a.team)==null?void 0:f.id)??""),c=(a==null?void 0:a.homeAway)==="home"?"home":"away";l&&o.set(l,c)}const i={home:[],away:[]};return t.forEach((a,l)=>{var T,y,b,E,A,C,_,N,U;const c=String(((T=a==null?void 0:a.team)==null?void 0:T.id)??"");(y=a==null?void 0:a.team)==null||y.displayName;let p;o.has(c)?p=o.get(c):(b=a==null?void 0:a.team)!=null&&b.homeAway?p=a.team.homeAway==="home"?"home":"away":p=l===0?"away":"home";let S=p;i[S].length>0&&(S=S==="home"?"away":"home");const d=((A=(E=a==null?void 0:a.statistics)==null?void 0:E[0])==null?void 0:A.names)??[],m=((_=(C=a==null?void 0:a.statistics)==null?void 0:C[0])==null?void 0:_.athletes)??[],v=[];for(const g of m){const P=((N=g==null?void 0:g.athlete)==null?void 0:N.displayName)??((U=g==null?void 0:g.athlete)==null?void 0:U.shortName)??"Unknown",$={},D=Array.isArray(g==null?void 0:g.stats)?g.stats:[];for(let k=0;k<d.length;k++){const R=d[k],x=D[k];if(R==="FG"||R==="3PT"||R==="FT"){const j=He(typeof x=="string"?x:String(x??"0-0")),K=R==="3PT"?"3P":R;$[`${K}A`]=j.attempts,$[`${K}M`]=j.makes,$[`${K}%`]=j.pct}else R==="MIN"?$.MIN=typeof x=="string"?x:String(x??""):R==="+/-"?$["+/-"]=Number(x??0):R&&($[R]=Number(x??0))}const B=$.MIN,G=(g==null?void 0:g.didNotPlay)===!0||typeof B=="string"&&B.toUpperCase()==="DNP";v.push({name:P,dnp:G,stats:$})}v.sort((g,P)=>{var k,R;const $=ae((k=g==null?void 0:g.stats)==null?void 0:k.MIN),D=ae((R=P==null?void 0:P.stats)==null?void 0:R.MIN),B=g.dnp||$<=0?1:0,G=P.dnp||D<=0?1:0;return B-G}),i[S]=v}),{players:i,names:r}}function Ke(s,e){var n,o,h,i,u,w,f;const t=((n=s==null?void 0:s.boxscore)==null?void 0:n.teams)??[],r={home:{team:{},periods:[],total:0},away:{team:{},periods:[],total:0}};for(const a of t){let l=((o=a==null?void 0:a.team)==null?void 0:o.homeAway)==="home"?"home":"away";(r[l].total!==0||Object.keys(r[l].team).length!==0)&&(l=l==="home"?"away":"home");const p=((a==null?void 0:a.linescores)??[]).map(d=>Number((d==null?void 0:d.value)??0)),S=Number((a==null?void 0:a.score)??0);r[l]={team:a==null?void 0:a.team,periods:p,total:S}}if((!((h=r.home.periods)!=null&&h.length)||!((i=r.away.periods)!=null&&i.length))&&e){const a=(u=e==null?void 0:e.competitions)==null?void 0:u[0],l=(w=a==null?void 0:a.competitors)==null?void 0:w.find(S=>S.homeAway==="away"),c=(f=a==null?void 0:a.competitors)==null?void 0:f.find(S=>S.homeAway==="home"),p=S=>(S??[]).map(d=>Number((d==null?void 0:d.value)??0));l&&(r.away={team:l.team,periods:p((l==null?void 0:l.linescores)??[]),total:Number(l.score??0)}),c&&(r.home={team:c.team,periods:p((c==null?void 0:c.linescores)??[]),total:Number(c.score??0)})}return r}class Ye{transformBoxscore(e,t){const{players:r,names:n}=je(e,t),o=Ke(e,t),h=(()=>{var c,p,S,d;const i=(c=t==null?void 0:t.competitions)==null?void 0:c[0],u=(p=i==null?void 0:i.status)==null?void 0:p.type,w=((S=i==null?void 0:i.status)==null?void 0:S.displayClock)||"",f=((d=i==null?void 0:i.status)==null?void 0:d.period)||0,a=(u==null?void 0:u.shortDetail)||"",l=(u==null?void 0:u.name)||"";return{clock:w,period:f,short:a,name:l}})();return{id:(e==null?void 0:e.id)||(t==null?void 0:t.id)||"",boxscore:(e==null?void 0:e.boxscore)??{},players:r,linescores:o,names:n,status:h}}}class We{constructor(){I(this,"BASE_URL","/api/reddit");I(this,"USER_AGENT","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 (arr-nba app)")}async getIndex(){if(typeof window<"u"){const e=await fetch(`${this.BASE_URL}/index`);if(!e.ok)throw new Error(`Reddit Index error: ${e.status}`);return e.json()}else{const e="https://www.reddit.com/r/nba/search.json?q=Daily%20Game%20Thread%20Index&restrict_sr=1&sort=new";console.log(`Fetching Reddit index from: ${e}`);const t=await fetch(e,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!t.ok){const r=await t.text();throw console.error(`Reddit Index error ${t.status}: ${r.slice(0,100)}`),new Error(`Reddit Index error: ${t.status}`)}return t.json()}}async searchRaw(e){if(typeof window<"u"){const t=await fetch(`${this.BASE_URL}/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})});if(!t.ok)throw new Error(`Reddit Search error: ${t.status}`);return t.json()}else{const t=`https://www.reddit.com/r/nba/search.json?q=${encodeURIComponent(e)}&restrict_sr=1&sort=new&t=week`;console.log(`Searching Reddit with: ${t}`);const r=await fetch(t,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!r.ok){const n=await r.text();throw console.error(`Reddit Search error ${r.status}: ${n.slice(0,100)}`),new Error(`Reddit Search error: ${r.status}`)}return r.json()}}async getCommentsRaw(e,t,r){if(typeof window<"u"){const n=new URL(`${window.location.origin}${this.BASE_URL}/comments/${e}`);n.searchParams.set("sort",t),r&&n.searchParams.set("permalink",r);const o=await fetch(n.toString());if(!o.ok){console.warn(`Reddit Comments API Route error ${o.status}, trying direct fetch...`);const h=r?`https://www.reddit.com${r}.json?sort=${t}`:`https://www.reddit.com/comments/${e}.json?sort=${t}`,i=await fetch(h);if(!i.ok)throw new Error(`Reddit Comments direct error: ${i.status}`);return i.json()}return o.json()}else{const n=r?`https://www.reddit.com${r}.json?sort=${t}`:`https://www.reddit.com/comments/${e}.json?sort=${t}`;console.log(`Fetching Reddit comments from: ${n}`);const o=await fetch(n,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!o.ok){const h=await o.text();throw console.error(`Reddit Comments error ${o.status}: ${h.slice(0,100)}`),new Error(`Reddit Comments error: ${o.status}`)}return o.json()}}async getThreadContent(e){if(typeof window<"u"){const t=new URL(`${window.location.origin}${this.BASE_URL}/comments/none`);t.searchParams.set("permalink",e);const r=await fetch(t.toString());if(!r.ok)throw new Error(`Reddit Thread Content error: ${r.status}`);return r.json()}else{const t=`https://www.reddit.com${e}.json`;console.log(`Fetching Reddit thread content from: ${t}`);const r=await fetch(t,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!r.ok){const n=await r.text();throw console.error(`Reddit Thread Content error ${r.status}: ${n.slice(0,100)}`),new Error(`Reddit Thread Content error: ${r.status}`)}return r.json()}}async getSubredditFeed(e,t="new"){if(typeof window<"u"){const r=await fetch(`${this.BASE_URL}/subreddit/${e}?sort=${t}`);if(!r.ok)throw new Error(`Reddit Subreddit Feed error: ${r.status}`);return r.json()}else{const r=`https://www.reddit.com/r/${e}/${t}.json?limit=100`;console.log(`Fetching Reddit subreddit feed from: ${r}`);const n=await fetch(r,{headers:{"User-Agent":this.USER_AGENT,Accept:"application/json"}});if(!n.ok){const o=await n.text();throw console.error(`Reddit Subreddit Feed error ${n.status}: ${o.slice(0,100)}`),new Error(`Reddit Subreddit Feed error: ${n.status}`)}return n.json()}}async fetchRaw(e){const t={};typeof window>"u"&&(t.headers={"User-Agent":this.USER_AGENT});const r=await fetch(e,t);if(!r.ok)throw new Error(`Reddit fetchRaw error: ${r.status}`);return r.json()}}class Xe{transformSearch(e,t){var f;const r=((f=e==null?void 0:e.data)==null?void 0:f.children)??[],n=Date.now()/1e3,o=t==="post"?36*3600:24*3600;return{post:r.filter(a=>{var l;return n-(((l=a==null?void 0:a.data)==null?void 0:l.created_utc)??n)<=o}).filter(a=>{var p;const l=(((p=a==null?void 0:a.data)==null?void 0:p.title)||"").toLowerCase(),c=l.includes("post game thread")||l.includes("post-game thread")||l.includes("postgame thread");return t==="post"?c:l.includes("game thread")&&!c}).sort((a,l)=>{var c,p;return(((c=l.data)==null?void 0:c.created_utc)??0)-(((p=a.data)==null?void 0:p.created_utc)??0)}).map(a=>{var l,c,p,S,d,m;return{id:(l=a==null?void 0:a.data)==null?void 0:l.id,title:(c=a==null?void 0:a.data)==null?void 0:c.title,permalink:(p=a==null?void 0:a.data)==null?void 0:p.permalink,url:`https://www.reddit.com${(S=a==null?void 0:a.data)==null?void 0:S.permalink}`,created_utc:(d=a==null?void 0:a.data)==null?void 0:d.created_utc,score:(m=a==null?void 0:a.data)==null?void 0:m.score}})[0]||null}}transformComments(e){var r;if(!e||!Array.isArray(e))return console.error("Reddit Transformer: Invalid JSON structure for comments:",(r=JSON.stringify(e))==null?void 0:r.slice(0,200)),{comments:[]};const t=e[1];return t||console.warn("Reddit Transformer: No comments data found in json[1]"),{comments:this.toTree(t)}}transformIndex(e){var h,i,u,w,f,a,l;const r=(((f=(w=(u=(i=(h=e==null?void 0:e[0])==null?void 0:h.data)==null?void 0:i.children)==null?void 0:u[0])==null?void 0:w.data)==null?void 0:f.selftext)??"").split(`
`),n={};for(const c of r){const p=/\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/.exec(c);if(!p)continue;const S=p[1],d=p[2],m=S.toLowerCase().includes("post game thread"),v=((a=S.split(":")[1])==null?void 0:a.trim())??S,[T,y]=v.split(" at ").map(_=>_==null?void 0:_.trim());if(!T||!y)continue;const b=[this.mascotName(T),this.mascotName(y)].sort().join("|"),E=/comments\/([a-z0-9]+)\//.exec(d),A=(E==null?void 0:E[1])??"";n[b]=n[b]||{};const C={id:A,title:S,url:d};m?n[b].pgt=C:n[b].gdt=C}const o=["Knicks","76ers"].sort().join("|");return(l=n[o])!=null&&l.pgt,{mapping:n}}mascotName(e){const t=(e||"").toLowerCase(),r=["trail blazers","knicks","76ers","lakers","celtics","warriors","nets","raptors","bulls","cavaliers","pistons","pacers","bucks","heat","magic","hawks","hornets","wizards","mavericks","rockets","grizzlies","pelicans","spurs","nuggets","timberwolves","suns","kings","clippers","thunder","jazz","blazers"];for(const n of r)if(t.includes(n))return n==="blazers"||n==="trail blazers"?"Trail Blazers":n.split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");return e}toTree(e,t=0){var o;if(!e||!e.data||!e.data.children)return t===0&&console.warn("Reddit Transformer: toTree called with invalid structure:",(o=JSON.stringify(e))==null?void 0:o.slice(0,200)),[];const r=e.data.children,n=[];for(const h of r){const i=h==null?void 0:h.data;if((h==null?void 0:h.kind)!=="t1")continue;const u={id:i==null?void 0:i.id,author:i==null?void 0:i.author,score:(i==null?void 0:i.score)??0,body:(i==null?void 0:i.body)??"",created_utc:(i==null?void 0:i.created_utc)??0};t<2&&(i!=null&&i.replies)&&typeof i.replies=="object"&&(u.replies=this.toTree(i.replies,t+1)),n.push(u)}return n}}let Je=class{constructor(e,t,r){this.dataSource=e,this.transformer=t,this.cache=r}async getScoreboard(e){const t=e?`scoreboard:${e}`:"scoreboard";return this.cache.getOrFetch(t,async()=>{const r=await this.dataSource.getScoreboard(e);return{events:(r==null?void 0:r.events)??[]}},30*1e3)}async getBoxscore(e){const t=`boxscore:${e}`;return this.cache.getOrFetch(t,async()=>{const[r,n]=await Promise.all([this.dataSource.getSummary(e),this.getScoreboard()]),o=n.events.find(h=>String(h.id)===String(e));return this.transformer.transformBoxscore(r,o)},15*1e3)}async prewarmBoxscores(e){const t=e.map(r=>this.getBoxscore(r).catch(n=>{console.warn(`Failed to prewarm boxscore ${r}:`,n)}));await Promise.allSettled(t)}cleanupCache(){this.cache.cleanup&&this.cache.cleanup()}};class qe{constructor(e,t,r){this.dataSource=e,this.transformer=t,this.cache=r}readBrowserCache(e,t){if(typeof window>"u")return null;try{const r=localStorage.getItem(e);if(!r)return null;const n=JSON.parse(r);return!n||typeof n.ts!="number"||Date.now()-n.ts>t?null:n.data}catch{return null}}writeBrowserCache(e,t){if(!(typeof window>"u"))try{localStorage.setItem(e,JSON.stringify({ts:Date.now(),data:t}))}catch{}}async getRedditIndex(){var n,o,h;const e="reddit:index",t=this.cache.get(e);if(t&&!(t instanceof Promise))return t;const r=this.readBrowserCache(e,600*1e3);if(r)return this.cache.set(e,r,6e5),r;try{let i;try{i=await this.dataSource.searchRaw("Daily Game Thread Index")}catch(a){if(a.message.includes("403")||a.message.includes("429"))console.warn("Reddit Index search blocked, falling back to hot feed"),i=await this.dataSource.getSubredditFeed("nba","hot");else throw a}const u=((n=i==null?void 0:i.data)==null?void 0:n.children)??[],f=u.sort((a,l)=>{var c,p;return(((c=l.data)==null?void 0:c.created_utc)??0)-(((p=a.data)==null?void 0:p.created_utc)??0)}).find(a=>{var l,c,p;return(p=(c=(l=a==null?void 0:a.data)==null?void 0:l.title)==null?void 0:c.toLowerCase())==null?void 0:p.includes("daily game thread index")});if(!f){if(u.length>0&&!u.some(a=>{var l,c,p;return(p=(c=(l=a==null?void 0:a.data)==null?void 0:l.title)==null?void 0:c.toLowerCase())==null?void 0:p.includes("daily game thread index")})){const a=await this.dataSource.getSubredditFeed("nba","hot"),l=(h=(o=a==null?void 0:a.data)==null?void 0:o.children)==null?void 0:h.find(c=>{var p,S,d;return(d=(S=(p=c==null?void 0:c.data)==null?void 0:p.title)==null?void 0:S.toLowerCase())==null?void 0:d.includes("daily game thread index")});if(l)return this.processIndexPost(l.data,e)}return{}}return this.processIndexPost(f.data,e)}catch(i){return console.error("Error fetching Reddit Index:",i),{}}}async processIndexPost(e,t){const r=await this.dataSource.getThreadContent(e.permalink),{mapping:n}=this.transformer.transformIndex(r);return this.cache.set(t,n,6e5),this.writeBrowserCache(t,n),n}async searchRedditThread(e){const t=this.buildSearchQuery(e);let r;try{r=await this.dataSource.searchRaw(t)}catch(o){if(o.message.includes("403")||o.message.includes("429"))return console.warn("Reddit search blocked, falling back to feed-based search"),this.fallbackSearchFromFeed(e);throw o}return this.transformer.transformSearch(r,e.type)}async fallbackSearchFromFeed(e){var t,r;try{const[n,o]=await Promise.all([this.dataSource.getSubredditFeed("nba","new"),this.dataSource.getSubredditFeed("nba","hot")]),h=[...((t=n==null?void 0:n.data)==null?void 0:t.children)??[],...((r=o==null?void 0:o.data)==null?void 0:r.children)??[]],i=new Set,w={data:{children:h.filter(f=>i.has(f.data.id)?!1:(i.add(f.data.id),!0))}};return this.transformer.transformSearch(w,e.type==="post"?"post":"live")}catch(n){return console.error("Fallback feed search failed:",n),{post:void 0}}}async getRedditComments(e,t="new",r,n=!1){const o=`reddit:comments:${e}:${t}`,h=t==="top"?12e4:3e4,i=this.cache.get(o);if(i&&!(i instanceof Promise)&&!n)return i;if(!n){const f=this.readBrowserCache(o,h);if(f)return this.cache.set(o,f,h),f}const u=await this.dataSource.getCommentsRaw(e,t,r),w=this.transformer.transformComments(u);return this.cache.set(o,w,h),this.writeBrowserCache(o,w),w}buildSearchQuery(e){const t=e.type==="post"?'"POST GAME THREAD"':'"GAME THREAD"',r=[...e.awayCandidates,...e.homeCandidates].map(o=>`"${o}"`).join(" "),n=e.type==="live"?' -"POST GAME THREAD"':"";return`${t} ${r}${n}`}clearRedditCache(){this.cache.clear()}}class Ve{constructor(){I(this,"nbaService");I(this,"redditService");const e=new Fe,t=new Ye,r=new We,n=new Xe;this.nbaService=new Je(e,t,ne),this.redditService=new qe(r,n,ne)}async getScoreboard(e){return this.nbaService.getScoreboard(e)}async getBoxscore(e){return this.nbaService.getBoxscore(e)}async getRedditIndex(){return this.redditService.getRedditIndex()}async searchRedditThread(e){return this.redditService.searchRedditThread(e)}async getRedditComments(e,t="new",r,n=!1){return this.redditService.getRedditComments(e,t,r,n)}async prewarmBoxscores(e){return this.nbaService.prewarmBoxscores(e)}clearRedditCache(){this.redditService.clearRedditCache()}async forceRefreshReddit(){this.clearRedditCache()}cleanupCache(){this.nbaService.cleanupCache()}}const it=new Ve;function oe(s){return(s||"").toLowerCase().includes("trail blazers")?"Trail Blazers":s}function Qe(s,e){return[oe(s),oe(e)].sort().join("|")}function ct(s){const e=Math.floor(Date.now()/1e3),t=Math.max(0,e-(Number(s)||0));if(t<60)return"just now";const r=Math.floor(t/60);if(r<60)return`${r}m ago`;const n=Math.floor(r/60);return n<24?`${n}h ago`:`${Math.floor(n/24)}d ago`}async function le(s,e,t){if(!e||!t)return{};const r=Qe(e,t),n=await s.getRedditIndex(),o=n==null?void 0:n[r];let h=o==null?void 0:o.gdt,i=o==null?void 0:o.pgt;const u=[];return h||u.push(s.searchRedditThread({type:"live",awayCandidates:[e],homeCandidates:[t]}).then(w=>{w!=null&&w.post&&(h=w.post)}).catch(()=>{})),i||u.push(s.searchRedditThread({type:"post",awayCandidates:[e],homeCandidates:[t]}).then(w=>{w!=null&&w.post&&(i=w.post)}).catch(()=>{})),u.length>0&&await Promise.allSettled(u),{liveThread:h,postThread:i}}async function dt(s,e,t){const{liveThread:r,postThread:n}=await le(s,e,t);r&&s.getRedditComments(r.id,"new",r.permalink).catch(()=>{}),n&&s.getRedditComments(n.id,"top",n.permalink).catch(()=>{})}async function lt(s,e,t){const{liveThread:r}=await le(s,e,t);r&&await s.getRedditComments(r.id,"new",r.permalink,!0)}function ht(s){const e=((s==null?void 0:s.abbreviation)||"").toUpperCase(),t={SA:"SAS",NO:"NOP",GS:"GSW",NY:"NYK",PHO:"PHX",WSH:"WAS",UTAH:"UTA",TOR:"TOR",MIN:"MIN",MIA:"MIA",SAS:"SAS"},r=((s==null?void 0:s.shortDisplayName)||(s==null?void 0:s.displayName)||"").toUpperCase(),n={UTAH:"UTA","LOS ANGELES CLIPPERS":"LAC","LA CLIPPERS":"LAC","LOS ANGELES LAKERS":"LAL","LA LAKERS":"LAL","GOLDEN STATE":"GSW","NEW ORLEANS":"NOP","SAN ANTONIO":"SAS","NEW YORK":"NYK",PHOENIX:"PHX",WASHINGTON:"WAS"},o=t[e]||e;return!n[r]&&r.includes("UTAH")?"UTA":n[r]||o||""}function ut(s={}){let e=0,t=0,r=!1,n=!1;const o=s.threshold||50,h=s.target||(typeof document<"u"?document:null);if(!h)return{destroy:()=>{}};function i(a){var d,m,v,T,y;const l=(d=a.touches)==null?void 0:d[0];if(!l)return;e=l.clientX,t=l.clientY,r=!1;const c=a.target;if(n=!!((m=c==null?void 0:c.closest)!=null&&m.call(c,'[data-no-swipe="true"]')),n)return;const p=!!((v=c==null?void 0:c.closest)!=null&&v.call(c,".swipe-area"))||document.body.classList.contains("swipe-area")||document.documentElement.classList.contains("swipe-area"),S=!!((T=c==null?void 0:c.closest)!=null&&T.call(c,'[data-scrollable="true"]'))||!!((y=c==null?void 0:c.closest)!=null&&y.call(c,".scroll-container"));p?r=!1:S&&(r=!0)}function u(a){var S,d;if(n)return;const l=(S=a.touches)==null?void 0:S[0];if(!l)return;const c=l.clientX-e,p=l.clientY-t;!r&&Math.abs(c)>Math.abs(p)&&((d=s.onHorizontalDrag)==null||d.call(s,c))}function w(a){var d,m,v;if(n){n=!1,(d=s.onGestureEnd)==null||d.call(s,!1);return}const l=(m=a.changedTouches)==null?void 0:m[0];if(!l)return;const c=l.clientX-e,p=l.clientY-t;let S=!1;Math.abs(c)>o&&Math.abs(p)<100&&(r||(c>0&&s.onSwipeRight?(s.onSwipeRight(),S=!0):c<0&&s.onSwipeLeft&&(s.onSwipeLeft(),S=!0))),Math.abs(p)>o&&Math.abs(c)<40&&(p>0&&s.onSwipeDown?s.onSwipeDown():p<0&&s.onSwipeUp&&s.onSwipeUp()),e=0,t=0,r=!1,(v=s.onGestureEnd)==null||v.call(s,S)}typeof window<"u"&&(h.addEventListener("touchstart",i,{capture:!0,passive:!0}),h.addEventListener("touchmove",u,{capture:!0,passive:!0}),h.addEventListener("touchend",w,{capture:!0,passive:!0}));const f=()=>{h.removeEventListener("touchstart",i,{capture:!0}),h.removeEventListener("touchmove",u,{capture:!0}),h.removeEventListener("touchend",w,{capture:!0})};try{Me(f)}catch{}return{destroy:f}}export{at as a,Qe as b,ut as c,st as e,ct as f,ht as g,rt as i,it as n,dt as p,lt as r,nt as s};
